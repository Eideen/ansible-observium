---
- name: Include prerequisites for Redhat
  yum: name=smokeping state=installed
  when: ansible_os_family == "RedHat"

- name: Include prerequisites for Debain/Ubuntu
  apt: name=smokeping state=installed
  when: ansible_os_family == "Debian"

- name: Controlling config  for target2
  lineinfile:
   path: /etc/smokeping/config
   regexp: '^@include /etc/smokeping/config.d/Targets2'
   line: '@include /etc/smokeping/config.d/Targets2'
   backup: yes
  notify:
   - restart smokeping

   

- name: template rrdcached service unit
  template: >-
    src=rrdcached.service.j2
    dest=/etc/systemd/system/rrdcached.service
    owner=root
    group=root
    mode=0644
  when: ansible_os_family == "RedHat"

- name: template rrdcached service unit
  template: >-
    src=rrdcached.debain.j2
    dest=/etc/default/rrdcached
    owner=root
    group=root
    mode=0644
  when: ansible_os_family == "Debian"

- name: enable and start rrdcached
  service:
    name=rrdcached
    enabled=yes
    state=restated
